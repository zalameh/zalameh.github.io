<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>PostgreSQL Cheatsheet</title>
<style>
:root {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  background-color: #dedede;
}

body {
  padding: 0;
  margin: 0;
}

.container {
  padding-top: 36px;
  margin-left: 5vw;
  margin-right: 5vw;
}

@media screen and (max-width: 480px) {
  .container {
    margin-left: 2vw;
    margin-right: 2vw;
  }
}

</style>
</head>
<body class="article">
<div id="header">
<h1>PostgreSQL Cheatsheet</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_common">Common</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_reset_auto_increment_ids_in_postgres">Reset auto-increment ids in postgres</h3>
<div class="listingblock">
<div class="content">
<pre>ALTER SEQUENCE &lt;table name&gt;_&lt;column name&gt;_seq RESTART WITH &lt;reset id&gt;;

ALTER SEQUENCE product_id_seq RESTART WITH 1;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_alter_password">Alter password</h3>
<div class="literalblock">
<div class="content">
<pre>ALTER USER name [ [ WITH ] option [ ... ] ]</pre>
</div>
</div>
<div class="paragraph">
<p>where option can be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATEDB | NOCREATEDB
| CREATEUSER | NOCREATEUSER
| [ ENCRYPTED | UNENCRYPTED ] PASSWORD 'password'
| VALID UNTIL 'abstime'</pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ALTER USER thename WITH ENCRYPTED PASSWORD 'thepassword';</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_user">Create user</h3>
<div class="literalblock">
<div class="content">
<pre>CREATE USER name [ [ WITH ] option [ ... ] ]</pre>
</div>
</div>
<div class="paragraph">
<p>where option can be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SYSID uid
| CREATEDB | NOCREATEDB
| CREATEUSER | NOCREATEUSER
| IN GROUP groupname [, ...]
| [ ENCRYPTED | UNENCRYPTED ] PASSWORD 'password'
| VALID UNTIL 'abstime'</pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE USER miriam WITH PASSWORD 'jw8s0F4' VALID UNTIL '2005-01-01' CREATEDB;</pre>
</div>
</div>
<div class="paragraph">
<p>Create user miriam with password &#8230;&#8203; valid until &#8230;&#8203; and can create database.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_backup">Backup</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_export">Export</h3>
<div class="literalblock">
<div class="content">
<pre>$ pg_dump [connection-option…] [option…] [dbname]</pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ pg_dump dangerousdb &gt; /tmp/db.sql
$ pg_dump -U postgres dvdrental &gt; /tmp/dvdrental-backup.sql</pre>
</div>
</div>
<div class="paragraph">
<p><code>-U</code>, username, Connect as the given user<br>
<code>-W</code>, Force a password prompt. This should happen automatically if the server requires password authentication.<br>
<code>-F</code>, format, Selects the format of the output. format can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>p, Output a plain-text SQL script file (default).</p>
</li>
<li>
<p>t, Output a tar archive suitable for input into pg_restore. Using this archive format allows reordering and/or exclusion of schema elements at the time the database is restored. It is also possible to limit which data is reloaded at restore time.</p>
</li>
<li>
<p>c, Output a custom archive suitable for input into pg_restore. This is the most flexible format in that it allows reordering of data load as well as schema elements. This format is also compressed by default.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_import">Import</h3>
<div class="literalblock">
<div class="content">
<pre>$ psql -U postgres -d fgorm &lt; /tmp/test.sql</pre>
</div>
</div>
<div class="paragraph">
<p><code>-U</code>, username, Connect as the given user<br>
<code>-F</code>, format, Selects the format of the output. format can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>p, Output a plain-text SQL script file (default).</p>
</li>
<li>
<p>t, Output a tar archive suitable for input into pg_restore. Using this archive format allows reordering and/or exclusion of schema elements at the time the database is restored. It is also possible to limit which data is reloaded at restore time.</p>
</li>
<li>
<p>c, Output a custom archive suitable for input into pg_restore. This is the most flexible format in that it allows reordering of data load as well as schema elements. This format is also compressed by default.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docker">Docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Download an image from docker hub:</p>
</div>
<div class="paragraph">
<p><a href="https://hub.docker.com/" class="bare">https://hub.docker.com/</a></p>
</div>
<div class="paragraph">
<p>For this example we&#8217;re using <code>postgres:15.0-alpine3.16</code> image.</p>
</div>
<div class="paragraph">
<p>Run example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker run \
  --name mypostgres \
  -p 5432:5432 \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=ip_addresses \
  -v /data:/home/wiji/Documents/mypostgres \
  -d \
  postgres:15.0-alpine3.16</pre>
</div>
</div>
<div class="paragraph">
<p>Open postgres shell:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker exec -it mypostgres
docker exec -it mypostgres psql -U postgres -W ip_addresses</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gorm">gorm</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>dsn := "host=localhost user=gorm password=gorm dbname=gorm port=9920 sslmode=disable TimeZone=Asia/Shanghai"</pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-01-09 09:01:50 +0700
</div>
</div>
</body>
</html>